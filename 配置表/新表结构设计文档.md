# 新表结构设计文档

## 📋 文档说明

本文档详细描述了项目的新版配置表结构设计，包含三个核心配置表：对话表（Talk）、角色静态数据表（NPCStaticData）、物品静态数据表（ItemStaticData）。

**设计理念**：数据与逻辑分离，只在配置表中存储纯静态展示数据，游戏逻辑由代码管理。

**版本**：v2.0
**日期**：2025-11-12
**导出格式**：JSON

---

## 1. Talk表（对话表）

### 1.1 表结构

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| **id** | int | 对话唯一ID，9位数字<br>命名规则：前3位=人物专属数字，中3位=第几次对话，后3位=第几句对话 | 001001001 |
| **step** | int | 对话步骤（某次对话的步骤序号，方便查看） | 1, 2, 3... |
| **speakType** | int | 对话类型<br>1=旁白<br>2=正常人物说话<br>3=空白 | 2 |
| **waitTime** | float | 等待时间（可选，控制对话显示节奏） | 3.0 |
| **cnSpeaker** | string | 说话人中文名字 | 百田解斗 |
| **enSpeaker** | string | 说话人英文名字 | Kaito Momota |
| **imagePath** | string | 说话人头像存放路径 | Art/UI/Character/Kaito |
| **voicePath** | string | 说话人语音切片存放路径 | Audio/Voice/百田01.mp3 |
| **cnWords** | string | 中文台本（对话内容） | 喂，你刚才为什么要道歉? |
| **enWords** | string | 英文台本（对话内容） | Hello, why did you apologize just now? |
| **next** | string | 下一句对话ID<br>支持分支：用 `/` 分隔多个ID<br>0 表示结束 | 001001002<br>001001009/001001011/001001013<br>0 |
| **script** | string | 调用代码类型<br>`audio` - 调用音效<br>`shake` - 调用相机震动<br>`branches` - 选项分支<br>`end` - 对话结束 | audio<br>branches<br>end |
| **Parameter0** | string | 代码参数1（根据script类型使用） | TalkAudio001 |
| **Parameter1** | string | 代码参数2 | A |
| **Parameter2** | string | 代码参数3 | B |
| **Parameter3** | string | 代码参数4 | 退出 |

### 1.2 ID命名规则详解

**格式**：`NNNXXXYYY`
- `NNN`（3位）：人物专属编号
  - 001 = 百田解斗
  - 002 = 赤松枫
  - 003 = 最原终一
  - 210 = 系统/旁白
  - 220 = 其他角色
- `XXX`（3位）：该人物的第几次对话
  - 001 = 第一次对话
  - 002 = 第二次对话
- `YYY`（3位）：该次对话的第几句话
  - 001 = 第一句
  - 002 = 第二句

**示例**：
- `001001001` = 百田解斗的第1次对话的第1句
- `001001016` = 百田解斗的第1次对话的第16句
- `001002001` = 百田解斗的第2次对话的第1句
- `210001` = 系统旁白1
- `220002` = 其他角色对话2

### 1.3 script字段使用说明

#### audio（音效）
```json
{
  "script": "audio",
  "Parameter0": "TalkAudio001",  // 音效资源路径
  "Parameter1": "",               // 音量（可选）
  "Parameter2": "",               // 是否循环（可选）
  "Parameter3": ""
}
```

#### shake（相机震动）
```json
{
  "script": "shake",
  "Parameter0": "",  // 震动强度（可选）
  "Parameter1": "",  // 震动时长（可选）
  "Parameter2": "",
  "Parameter3": ""
}
```

#### branches（选项分支）
```json
{
  "script": "branches",
  "Parameter0": "A",      // 选项A文本
  "Parameter1": "B",      // 选项B文本
  "Parameter2": "C",      // 选项C文本
  "Parameter3": "退出",   // 选项D文本
  "next": "001001009/001001011/001001013/001002001"  // 对应的跳转ID
}
```

#### end（对话结束）
```json
{
  "script": "end",
  "next": "0"  // next设为0或空
}
```

### 1.4 对话流程示例

```
百田解斗的第1次对话流程：

001001001 (step 1) → 001001002 (step 2) → 001001003 (step 3)
→ 001001004 (step 4) → 001001005 (step 5) → 001001006 (step 6)
→ 001001007 (step 7) → 001001008 (step 8, branches)
                        ├─ A选项 → 001001009 (step 9) → 001001010 → 返回step 8
                        ├─ B选项 → 001001011 (step 11) → 001001012 → 返回step 8
                        ├─ C选项 → 001001013 (step 13) → 001001014 → 返回step 8
                        └─ 退出 → 001001015 (step 15) → 001002001 (第2次对话)
```

### 1.5 数据示例

```json
{
  "id": 001001001,
  "step": 1,
  "speakType": 2,
  "waitTime": 3,
  "cnSpeaker": "百田解斗",
  "enSpeaker": "Kaito Momota",
  "imagePath": "Art/UI/Character/Kaito",
  "voicePath": "Audio/Voice/百田01.mp3",
  "cnWords": "喂，你刚才为什么要道歉?你没有做错任何事吧?",
  "enWords": "Hello, why did you apologize just now? Didn't you do anything wrong?",
  "next": "001001002",
  "script": "audio",
  "Parameter0": "TalkAudio001",
  "Parameter1": "",
  "Parameter2": "",
  "Parameter3": ""
}
```

---

## 2. NPCStaticData表（角色静态数据表）

### 2.1 表结构

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| **id** | string | NPC唯一ID（专属ID，导表时的Key） | 百田解斗 |
| **cnName** | string | 中文名字 | 百田解斗 |
| **enName** | string | 英文名字 | Kaito Momota |
| **path1** | string | 人物美术资源（UI头像）存储路径<br>格式：`Art/UI/Character/Name` | Art/UI/Character/Kaito |
| **path2** | string | 其他美术资源路径2（可选） | Art/UI/Character/Kaito_Portrait |
| **path3** | string | 其他美术资源路径3（可选） | Art/UI/Character/Kaito_Icon |
| **cnTestimony1** | string | 中文证词1（可从对话中提取的证词） | 他当时在现场看到了可疑人物 |
| **cnTestimony2** | string | 中文证词2 | 他听到了奇怪的声音 |
| **cnTestimony3** | string | 中文证词3 | 他的不在场证明有疑点 |
| **enTestimony1** | string | 英文证词1 | He saw a suspicious person at the scene |
| **enTestimony2** | string | 英文证词2 | He heard a strange sound |
| **enTestimony3** | string | 英文证词3 | His alibi is questionable |
| **cnDescribe1** | string | 中文描述（介绍人物背景等） | 自称超高校级的宇航员，充满热血的少年 |
| **cnDescribe2** | string | 中文描述2（可选，不同场景的描述） | 虽然粗鲁但内心善良，总是鼓励他人 |
| **cnDescribe3** | string | 中文描述3（可选） | |
| **enDescribe1** | string | 英文描述1 | Ultimate Astronaut, a passionate young man |
| **enDescribe2** | string | 英文描述2 | Rough but kind-hearted, always encouraging others |
| **enDescribe3** | string | 英文描述3 | |

### 2.2 设计说明

**存储内容**：
- 角色的基础身份信息（名字、ID）
- 美术资源路径（头像、立绘等）
- 角色描述信息（背景、性格等）
- 可提取的证词信息

**不存储的内容**（由代码管理）：
- ❌ 解锁条件（UnlockCondition）
- ❌ 选中状态（SelectedState）
- ❌ 标记状态（Marked）
- ❌ 对话内容ID列表（DialogueContent）
- ❌ 指证内容ID（ExposeMessage）

### 2.3 扩展性

字段支持自由扩展，如需要更多描述或证词：
- 添加 `cnDescribe4`, `cnDescribe5`...
- 添加 `cnTestimony4`, `cnTestimony5`...
- 添加 `path4`, `path5`...

### 2.4 数据示例

```json
{
  "id": "百田解斗",
  "cnName": "百田解斗",
  "enName": "Kaito Momota",
  "path1": "Art/UI/Character/Kaito",
  "path2": "Art/UI/Character/Kaito_Portrait",
  "path3": "",
  "cnTestimony1": "他当时在现场看到了可疑人物",
  "cnTestimony2": "他听到了奇怪的声音",
  "cnTestimony3": "",
  "enTestimony1": "He saw a suspicious person at the scene",
  "enTestimony2": "He heard a strange sound",
  "enTestimony3": "",
  "cnDescribe1": "自称超高校级的宇航员，充满热血的少年",
  "cnDescribe2": "虽然粗鲁但内心善良，总是鼓励他人",
  "cnDescribe3": "",
  "enDescribe1": "Ultimate Astronaut, a passionate young man",
  "enDescribe2": "Rough but kind-hearted, always encouraging others",
  "enDescribe3": ""
}
```

---

## 3. ItemStaticData表（物品静态数据表）

### 3.1 表结构

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| **id** | string | 物品唯一ID（专属ID，导表时的Key） | item001 |
| **cnName** | string | 中文名字 | 工作记录卡 |
| **enName** | string | 英文名字 | Work Record Card |
| **itemType** | string | 物品类型<br>`item` - 可收集的物品<br>`clue` - 线索<br>`envir` - 环境物品（不可收集） | item |
| **cnDescribe1** | string | 中文描述（介绍物品） | Rosa Martinez - 11月15日夜班：后台走廊清洁 23:00-01:00 |
| **cnDescribe2** | string | 中文描述2（如：分析后的描述） | 根据工作记录，Rosa应该在后台走廊工作，但她声称在地下室 |
| **cnDescribe3** | string | 中文描述3（可选） | |
| **enDescribe1** | string | 英文描述1 | Rosa Martinez - Night shift on Nov 15: Backstage corridor cleaning 23:00-01:00 |
| **enDescribe2** | string | 英文描述2 | According to records, Rosa should be in the backstage corridor |
| **enDescribe3** | string | 英文描述3 | |
| **path1** | string | 物品美术资源存储路径<br>格式：`Art/UI/Item/Name` | Art/UI/Item/WorkCard |
| **path2** | string | 其他美术资源路径2（如：详细图片） | Art/UI/Item/WorkCard_Detail |
| **path3** | string | 其他美术资源路径3（可选） | |

### 3.2 itemType类型说明

| 类型 | 说明 | 使用场景 |
|------|------|----------|
| **item** | 可收集的物品 | 证据、道具、工具等，可以放入背包 |
| **clue** | 线索 | 推理线索、证词、记录等，不一定是实体物品 |
| **envir** | 环境物品 | 场景中的环境物品，只能查看不能收集 |

### 3.3 设计说明

**存储内容**：
- 物品的基础信息（名字、ID、类型）
- 物品描述信息（可多个，如：获得时/分析后/不同状态）
- 美术资源路径（图标、详细图等）

**不存储的内容**（由代码管理）：
- ❌ 相关NPC ID（RelatedNPCIDs）
- ❌ 相关场景ID（RelatedSceneID）
- ❌ 是否需要分析（AnalysisRequired）
- ❌ 可组合对象（CombinatableWith）
- ❌ 组合结果（CombineResult）
- ❌ 用于指证（UsedInExposure）
- ❌ 指证阶段（ExposureTime）
- ❌ 触发事件（TriggerEvent）
- ❌ 场景显示图标（DisplayAfterGot）

**为什么这样设计？**
- 物品的关联关系、组合逻辑、触发事件等都属于游戏逻辑，应该在代码中实现
- 配置表只存储展示给玩家的静态信息
- 逻辑变化时不需要重新导表，只需修改代码

### 3.4 多描述的使用场景

**cnDescribe1/enDescribe1**：物品获得时的初始描述
```
"一张白色毛巾"
```

**cnDescribe2/enDescribe2**：分析后的描述
```
"一条白色毛巾，散发着刺鼻的甜腻气味，毛巾上有明显的使用痕迹"
```

**cnDescribe3/enDescribe3**：特殊状态的描述
```
"经过化验，毛巾上残留的是氯仿成分"
```

### 3.5 数据示例

```json
{
  "id": "item001",
  "cnName": "工作记录卡",
  "enName": "Work Record Card",
  "itemType": "item",
  "cnDescribe1": "Rosa Martinez - 11月15日夜班：后台走廊清洁 23:00-01:00",
  "cnDescribe2": "根据工作记录，Rosa应该在后台走廊工作，但她声称在地下室酒窖",
  "cnDescribe3": "",
  "enDescribe1": "Rosa Martinez - Night shift on Nov 15: Backstage corridor cleaning 23:00-01:00",
  "enDescribe2": "According to the work record, Rosa should be working in the backstage corridor",
  "enDescribe3": "",
  "path1": "Art/UI/Item/WorkCard",
  "path2": "Art/UI/Item/WorkCard_Detail",
  "path3": ""
}
```

---

## 4. 通用规范

### 4.1 命名规范

**ID命名**：
- Talk表：9位纯数字，格式 `NNNXXXYYY`
- NPC表：使用中文名作为ID（如：百田解斗）
- Item表：使用 `item` + 3位数字（如：item001）

**路径格式**：
- 统一使用相对路径，从 `Assets` 的子目录开始
- 使用 `/` 作为路径分隔符（不要用 `\`）
- 示例：`Art/UI/Character/Kaito`

### 4.2 字符串规范

**多行文本**：
- 对话内容可以包含换行，使用 `\n` 表示
- 建议每句话不超过100个字符

**特殊字符**：
- 避免使用双引号 `"`，使用中文引号 `「」` 或单引号 `'`
- 避免使用反斜杠 `\`（路径除外）

**占位符**：
- 使用 `......` 表示省略或停顿
- 使用空字符串表示该字段未使用

### 4.3 扩展性设计

**如何添加新字段**：
1. 在Excel最右侧添加新列
2. 第一行（##var）：字段名
3. 第二行（##type）：字段类型
4. 第三行（##）：字段说明
5. 从第四行开始填写数据

**支持的字段类型**：
- `string`：字符串
- `int`：整数
- `float`：浮点数
- `bool`：布尔值（true/false）

---

## 5. 导表流程

### 5.1 Excel表格格式要求

```
行1（##var）：  id          cnName      enName      ...
行2（##type）： string      string      string      ...
行3（##）：     说明文本     说明文本     说明文本     ...
行4开始：       数据行1
行5：          数据行2
...
```

### 5.2 导出为JSON

导表工具会将Excel转换为JSON格式：

```json
{
  "TableName": [
    {
      "id": "value1",
      "cnName": "value2",
      ...
    },
    ...
  ]
}
```

### 5.3 加载流程

1. 游戏启动时，从 `Resources` 目录加载JSON文件
2. 解析JSON数据到内存中的Dictionary
3. 通过ID快速查询数据

---

## 6. 最佳实践

### 6.1 数据填写建议

**对话表**：
- 先规划好对话流程图，再填写数据
- 注意分支的连贯性，确保每个分支都有出口
- 语音文件命名要与voicePath对应

**NPC表**：
- 证词要精炼，一句话说清楚
- 描述要生动，让玩家了解角色性格
- 资源路径要与美术资源一致

**Item表**：
- 第一个描述要简洁，吸引玩家注意
- 分析后的描述要提供关键信息
- 类型选择要准确，影响游戏玩法

### 6.2 版本管理

**Excel文件管理**：
- 使用Git管理Excel文件
- 导表前先提交当前版本
- 重大改动时打tag

**JSON文件管理**：
- JSON文件也提交到Git
- 方便程序直接查看数据变化
- 避免导表错误影响开发

### 6.3 质量检查

**填表后检查**：
- [ ] ID是否唯一且符合命名规范
- [ ] next字段指向的ID是否存在
- [ ] 资源路径是否正确
- [ ] 中英文是否都有填写
- [ ] 特殊字符是否正确转义

**导表后测试**：
- [ ] 游戏能否正常加载配置
- [ ] 对话流程是否正常
- [ ] 分支跳转是否正确
- [ ] 资源能否正常显示
- [ ] 中英文切换是否正常

---

## 7. FAQ

### Q1: 为什么ID要用9位数字格式？
**A**: 便于管理和查询。通过ID就能知道是哪个角色的第几次对话第几句，不需要额外查表。

### Q2: 为什么不在配置表中存储关联关系？
**A**: 关联关系属于游戏逻辑，容易变化。放在代码中更灵活，修改不需要重新导表。

### Q3: 如果物品描述需要根据游戏进度动态变化怎么办？
**A**: 在表中存储多个描述（cnDescribe1/2/3），代码根据游戏状态选择显示哪一个。

### Q4: 对话分支最多支持几个选项？
**A**: 目前设计了4个参数（Parameter0-3），可支持4个选项。如需更多，可扩展Parameter4/5...

### Q5: 能否在对话中直接使用NPC的ID？
**A**: 可以，但新表设计是直接存储说话人名字（cnSpeaker/enSpeaker），更直观易维护。

---

## 8. 更新日志

### v2.0 (2025-11-12)
- 全新的表结构设计
- 数据与逻辑完全分离
- 完整的双语支持
- 规范的ID命名规则
- 强大的脚本系统

### v1.0 (旧版)
- 初始版本，数据与逻辑混合

---

## 附录

### A. 人物编号对照表

| 编号 | 人物名 | 说明 |
|------|--------|------|
| 001 | 百田解斗 | 超高校级的宇航员 |
| 002 | 赤松枫 | 超高校级的钢琴家 |
| 003 | 最原终一 | 超高校级的侦探 |
| 210 | 系统/旁白 | 系统提示信息 |
| 220 | 其他角色 | 其他角色通用编号 |

### B. 物品类型对照表

| 类型 | 英文 | 说明 |
|------|------|------|
| 物品 | item | 可收集的实体物品 |
| 线索 | clue | 推理线索、证词 |
| 环境 | envir | 场景环境物品 |

### C. 脚本类型对照表

| 类型 | 说明 | 参数使用 |
|------|------|----------|
| audio | 播放音效 | Parameter0=音效路径 |
| shake | 相机震动 | Parameter0=强度 |
| branches | 选项分支 | Parameter0-3=选项文本 |
| end | 对话结束 | 无参数 |

---

**文档结束**
