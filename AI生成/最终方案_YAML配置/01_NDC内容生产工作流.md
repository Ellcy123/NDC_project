# NDC内容生产工作流总结

## 🎯 核心理念

**策划通过对话驱动内容生产，AI负责维护结构化配置，程序直接读取配置文件。**

---

## 📊 工作流架构图

```
┌─────────────┐
│   策划      │
│  （您）      │
└──────┬──────┘
       │ 对话/需求
       ↓
┌─────────────────────┐
│   AI 内容助手       │
│  - 修改YAML配置      │ ← 主工作文件
│  - 验证逻辑完整性     │
│  - 生成可视化文档     │
└──────┬──────────────┘
       │
       ├──→ YAML配置文件 ────→ Unity直接读取 ────→ 游戏运行
       │
       └──→ Excel表格（预览）──→ 您查看确认
```

---

## 🔄 三个核心环节

### 环节1: 内容创作（您 + AI 对话）

**您的工作方式**：
```
您: "在Loop1添加一个Morrison警车场景，可以搜到赌债证据"

AI:
  1. 分析影响范围（需要改哪些Level）
  2. 修改YAML配置
  3. 验证配置完整性
  4. 生成Excel预览

您: 查看Excel预览 → 确认/调整
```

**您不需要**：
- ❌ 手动编辑JSON/YAML
- ❌ 记住所有字段名
- ❌ 手动检查引用关系
- ❌ 在Excel里改配置

**AI会做**：
- ✅ 维护YAML配置
- ✅ 自动验证逻辑（比如：引用的证据ID是否存在）
- ✅ 生成Excel供您查看
- ✅ 转换为Unity可用格式

---

### 环节2: 配置管理（AI自动处理）

**YAML配置文件**（主工作文件）：
```
d:\NDC_project\配置文件\
├── Level1_Unit1_Metadata.yaml        ← 章节元数据
├── Level2_Unit1_Loop1_Config.yaml    ← 循环配置
├── Level3_Unit1_Loop1_Dialog.yaml    ← 对话树
├── Level4_Unit1_Loop1_Evidence.yaml  ← 证据配置
├── Level5_Unit1_Loop1_Scene.yaml     ← 场景配置
└── Level6_Unit1_Loop1_Expose.yaml    ← 指证配置
```

**配置特点**：
- 使用 `_` 前缀区分策划备注和程序字段
- 支持中文注释
- Git版本管理友好
- 人类可读，AI可处理

---

### 环节3: 程序集成（Unity读取）

**方案A：Unity直接读YAML**（推荐）
```csharp
// 1. 安装YamlDotNet插件
// 2. 读取配置
var deserializer = new DeserializerBuilder().Build();
var config = deserializer.Deserialize<LoopConfig>(yamlText);
```

**方案B：AI转换为JSON**
```
YAML配置 ──AI转换──→ JSON ──Unity JsonUtility──→ 游戏
```

**选择建议**：
- 如果Unity团队接受装插件 → 方案A
- 如果不想装插件 → 方案B（AI每次修改后自动转JSON）

---

## 💬 典型对话场景

### 场景1: 新增场景

**您**：
```
在Loop1的自由探索阶段，添加"Morrison的警车"场景
- 可以搜证找到赌债欠条（EV010）
- 解锁条件跟其他搜证场景一样（D045完成）
```

**AI会做**：
1. ✅ 修改 `Level2_Loop1_Config.yaml` - 添加场景到 available_scenes
2. ✅ 修改 `Level4_Loop1_Evidence.yaml` - 添加证据EV010
3. ✅ 修改 `Level5_Loop1_Scene.yaml` - 添加场景详细配置（热区坐标等）
4. ✅ 检查：EV010在指证时是否需要用到？
5. ✅ 生成Excel预览供您查看

**AI会问您**：
- 这个证据是关键证据还是辅助证据？
- 在指证Rosa时需要用到这个证据吗？
- 场景背景图文件名是什么？

---

### 场景2: 修改证据

**您**：
```
把EV003（毛巾）改成不需要分析，直接收集就能看到氯仿气味
```

**AI会做**：
1. ✅ 修改 `Level4_Loop1_Evidence.yaml`
   ```yaml
   - evidence_id: EV003
     requires_analysis: false  # 改为false
     description: 一条白色毛巾，散发着刺鼻的甜腻气味  # 直接显示完整描述
   ```
2. ✅ 检查：指证配置是否受影响（不影响，因为只是收集方式变化）
3. ✅ 生成Excel预览

---

### 场景3: 调整指证难度

**您**：
```
Loop1对Rosa的指证，Normal模式改成允许3次重试（现在是2次）
```

**AI会做**：
1. ✅ 修改 `Level6_Loop1_Expose_Rosa.yaml`
   ```yaml
   rounds:
     - round: 1
       difficulty_settings:
         normal:
           wrong_attempts_allowed: 3  # 改为3
   ```
2. ✅ 同时修改 `Level2_Loop1_Config.yaml` 的难度配置（保持一致）
3. ✅ 生成Excel预览

---

### 场景4: 批量生成Loop2

**您**：
```
参考Loop1，帮我生成Loop2的配置框架
- 目标：调查Morrison的赌债动机
- 场景：Morrison家中、警局
- 证据：赌债欠条、赌场收据等
```

**AI会做**：
1. ✅ 复制Loop1的6个Level配置
2. ✅ 修改所有ID（Loop1 → Loop2）
3. ✅ 根据您的描述填充内容
4. ✅ 生成Excel预览
5. ✅ **标注哪些内容需要您补充**（比如对话文本）

---

## 📋 Excel预览的作用

**Excel不是用来编辑的，而是用来**：

### 1. 快速查看全局
- 一眼看到6个循环的目标
- 对比不同循环的证据数量
- 检查角色是否都有描述

### 2. 发现问题
- 证据ID重复了吗？
- 哪个场景没有解锁条件？
- 哪个指证没有配置难度？

### 3. 和团队沟通
- 发给美术：需要哪些场景背景图
- 发给程序：字段类型对不对
- 发给制作人：每个循环时长符合预期吗

### 4. 打印检查
- 打印出来在纸上标注
- 用荧光笔标记需要调整的部分
- 开会时投屏讨论

**但您不需要在Excel里改数字，改完告诉我就行。**

---

## 🔍 AI自动验证机制

每次您让我修改配置，我会自动检查：

### ✅ 引用完整性
- Level2引用的证据ID，Level4里存在吗？
- Level3引用的场景ID，Level5里定义了吗？
- Level6指证需要的证据，玩家能收集到吗？

### ✅ 逻辑闭环
- 玩家能完成这个循环吗？（有足够的证据触发指证）
- 场景解锁链条合理吗？（不会出现永远解锁不了的场景）
- 对话分支有死锁吗？（所有分支都能到达结尾）

### ✅ 数据一致性
- Loop1的难度配置 和 Level2里的难度配置 一致吗？
- 角色ID在所有配置文件中拼写一致吗？
- 证据优先级有冲突吗？

### ⚠️ 发现问题会提示
```
AI: 发现问题：
  1. EV010（赌债欠条）在Level4定义了，但Level5没有配置热区
     → 玩家无法收集这个证据

  2. SC107场景解锁条件是"EV011_Collected"，但EV011不存在
     → 场景永远无法解锁

是否需要我修复？
```

---

## 🎯 您需要做什么

### 日常工作
1. **提需求**（自然语言，不需要记字段名）
   - "添加一个场景"
   - "改一下证据描述"
   - "调整指证难度"

2. **查看预览**（Excel表格）
   - 确认改动正确
   - 发现需要补充的内容

3. **补充细节**（对话告诉我）
   - "对话内容改成xxx"
   - "证据描述不够生动，改成yyy"

### 不需要做
- ❌ 学习YAML语法
- ❌ 记住所有字段名
- ❌ 手动编辑配置文件
- ❌ 检查引用关系
- ❌ 在Excel里编辑数据

---

## 🚀 快速开始示例

**完整流程演示**：

```
第1天 - 创建Loop1框架
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
您: "帮我创建Loop1的配置框架"
AI: [生成6个Level的YAML + Excel预览]
您: "看起来不错"

第2天 - 添加具体内容
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
您: "添加SC103储藏室场景，包含5个证据"
AI: [修改Level2/4/5 + Excel预览]
您: "EV007的描述改详细点"
AI: [修改Level4 + 更新Excel]

第3天 - 配置指证
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
您: "配置对Rosa的三轮指证"
AI: [生成Level6 + Excel预览]
您: "Round2的问题改成更有压迫感的"
AI: [修改Level6 + 更新Excel]

第4天 - 验证和调整
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
您: "检查Loop1能通关吗"
AI: [验证逻辑] "✅ 可以通关，证据链完整"
您: "那生成Loop2框架吧"
AI: [参考Loop1生成Loop2]

第5天 - 交付程序
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
您: "把Loop1的配置转成JSON给程序"
AI: [生成JSON文件 + Unity读取示例代码]
程序: "收到，开始实现"
```

---

## 📂 文件管理建议

### 推荐目录结构
```
d:\NDC_project\
├── 配置文件\
│   ├── Unit1\
│   │   ├── Level1_Unit1_Metadata.yaml
│   │   ├── Loop1\
│   │   │   ├── Level2_Config.yaml
│   │   │   ├── Level3_Dialog.yaml
│   │   │   ├── Level4_Evidence.yaml
│   │   │   ├── Level5_Scene.yaml
│   │   │   └── Level6_Expose.yaml
│   │   └── Loop2\
│   │       └── ...
│   └── Unit2\
│       └── ...
│
├── 预览文件\
│   ├── Unit1_Loop1_预览.xlsx
│   └── Unit1_Loop2_预览.xlsx
│
└── 程序文件\
    ├── Unit1_Loop1_Config.json  ← 给Unity用
    └── ...
```

### 版本管理
```bash
# 所有YAML文件用Git管理
git add 配置文件/
git commit -m "调整Loop1指证难度"

# Excel预览文件不需要版本管理（可以随时重新生成）
```

---

## 🆘 常见问题

### Q1: 我不懂YAML语法怎么办？
**A**: 不需要懂！用自然语言告诉我要改什么，我来改YAML。

### Q2: 我想看YAML改了什么怎么办？
**A**: 我会告诉您改了哪些文件的哪些字段，或者对比显示改动。

### Q3: 配置文件太多，记不住怎么办？
**A**: 不需要记！告诉我要改什么内容，我知道要改哪个文件。

### Q4: Excel预览不够清晰怎么办？
**A**: 告诉我哪里不清晰，我调整表格结构。或者生成可视化流程图。

### Q5: 程序说配置文件格式不对？
**A**: 把错误信息发给我，我修复配置并验证。

---

## 🎓 下一步

1. **先看这个文档** - 理解工作流
2. **再看配置详解文档** - 了解每个Level的字段（我们一起调整）
3. **开始试用** - 让我帮您修改一个小配置，体验流程

---

**文档版本**: v1.0
**最后更新**: 2025-11-06
**下一份文档**: `02_NDC配置详解.md`（待我们一起完善）
