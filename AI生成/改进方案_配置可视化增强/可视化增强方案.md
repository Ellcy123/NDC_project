# NDC配置系统可视化增强方案

## 🎯 问题分析

当前配置存在的问题：
1. **过于面向代码**：JSON结构适合程序读取，但策划难以直观理解
2. **缺乏可视化**：场景热区坐标只有数字，无法预览布局
3. **编辑困难**：策划需要手动编辑JSON，容易出错
4. **关系不直观**：证据网络、对话树只有文本描述，缺乏图形化

## 💡 改进方案

### 方案A：双层架构（推荐）

```
策划层（可视化）          程序层（代码实现）
    ↓                        ↓
可视化编辑器              JSON配置文件
    ↓                        ↓
导出 ────────────→       Unity读取
```

#### 1. 策划层工具选择

**选项1: 使用现有工具**
- **Yarn Spinner** (对话树) - 可视化对话编辑
- **Miro/Figma** (场景标注) - 标注热区坐标
- **Excel/Notion** (表格) - 证据关系管理
- **yEd Graph Editor** (关系图) - 证据网络可视化

**选项2: 定制Unity Editor工具**
```csharp
// Unity编辑器扩展示例
[CustomEditor(typeof(SceneConfig))]
public class SceneConfigEditor : Editor {
    public override void OnInspectorGUI() {
        SceneConfig config = (SceneConfig)target;

        // 显示场景背景图
        EditorGUILayout.LabelField("Scene Preview:");
        Texture2D preview = AssetDatabase.LoadAssetAtPath<Texture2D>(config.backgroundImage);
        GUILayout.Label(preview);

        // 在图上可视化标注热区
        foreach (var hotspot in config.hotspots) {
            DrawHotspot(hotspot, preview);
        }
    }
}
```

**选项3: Web可视化编辑器**
- React + Konva.js 构建拖拽式场景编辑器
- 导出JSON配置文件供Unity使用

---

### 方案B：增强JSON配置的可读性

在现有JSON基础上添加可视化辅助信息

#### 示例：场景配置增强版

```json
{
  "scene_id": "SC103",
  "scene_name": "Rosa的储藏室",

  "visual_preview": {
    "thumbnail": "scene_preview/SC103_thumb.png",
    "annotated_image": "scene_preview/SC103_annotated.png",
    "description": "杂乱的储藏室，左侧是架子，中央是洗衣篮，右侧是桌子"
  },

  "hotspots": [
    {
      "hotspot_id": "HS_SC103_Shelf",
      "visual_label": "📋 架子上的文件",
      "coordinates": {
        "x": 1200,
        "y": 800,
        "width": 200,
        "height": 150,
        "preview_color": "#FF6B6B",
        "preview_annotation": "EV001 工作记录卡"
      },
      "evidence_id": "EV001"
    }
  ],

  "layout_diagram": {
    "ascii_art": "
      ┌─────────────────────────────────┐
      │  🗄️        🧺         📄       │
      │ 架子       洗衣篮      桌子      │
      │(EV001)    (EV003)    (EV007)   │
      └─────────────────────────────────┘
    ",
    "hotspot_map": [
      "[ ][ ][ ][ ][ ][ ][ ][ ][ ][ ]",
      "[ ][ ][1][1][ ][ ][ ][ ][ ][ ]",
      "[ ][ ][1][1][ ][ ][ ][ ][ ][ ]",
      "[ ][ ][ ][ ][2][2][ ][ ][ ][ ]",
      "[ ][ ][ ][ ][2][2][ ][3][ ][ ]"
    ]
  }
}
```

---

### 方案C：生成配套的可视化文档

为每个JSON配置自动生成可视化HTML/Markdown文档

#### 自动生成内容

1. **场景热区地图**
   - 在场景背景图上叠加热区标注
   - 显示证据ID和名称

2. **对话流程图**
   - Mermaid图表展示对话节点关系
   - 高亮分支选择点

3. **证据关系图**
   - D3.js/vis.js绘制证据网络
   - 节点表示证据，边表示关系类型

4. **指证逻辑表**
   - 表格形式展示三轮指证的证据要求

---

## 🛠️ 具体实现建议

### 阶段1: 快速解决（本周）

**使用现有工具 + 配置增强**

1. **场景可视化**
   - 用Figma/Photoshop在场景图上标注热区
   - 导出标注图放在 `scene_preview/` 文件夹
   - JSON中添加 `annotated_image` 字段引用

2. **对话树可视化**
   - 使用 **Mermaid** 语法生成流程图
   - 嵌入到Markdown文档中

3. **证据网络可视化**
   - 使用在线工具（如 yEd Live）绘制关系图
   - 导出为PNG/SVG嵌入文档

**工作量**: 2-3天

---

### 阶段2: 中期方案（2-4周）

**开发简易Web编辑器**

#### 功能模块

1. **场景编辑器**
   - 上传场景背景图
   - 拖拽矩形框标注热区
   - 绑定证据ID
   - 导出JSON

2. **对话树编辑器**
   - 节点拖拽式编辑
   - 连线表示对话流程
   - 导出JSON

3. **证据网络编辑器**
   - 节点表示证据
   - 连线表示关系（支持/矛盾/印证）
   - 自动检查逻辑闭环

#### 技术栈建议
```
前端: React + TypeScript
图形库: Konva.js (场景) + ReactFlow (对话树/证据网络)
数据: JSON导入导出
部署: 本地Electron应用 或 Web服务
```

**工作量**: 3-4周（1名前端开发）

---

### 阶段3: 长期方案（2-3个月）

**Unity编辑器深度集成**

#### 核心功能

1. **ScriptableObject可视化编辑**
   - 在Unity Inspector中直接编辑配置
   - 实时预览场景布局

2. **场景热区编辑**
   ```csharp
   [CustomEditor(typeof(SceneData))]
   public class SceneDataEditor : Editor {
       private void OnSceneGUI() {
           SceneData data = (SceneData)target;

           // 在Scene视图中绘制热区
           foreach (var hotspot in data.hotspots) {
               Handles.DrawWireCube(
                   new Vector3(hotspot.x, hotspot.y, 0),
                   new Vector3(hotspot.width, hotspot.height, 0)
               );

               Handles.Label(
                   new Vector3(hotspot.x, hotspot.y, 0),
                   hotspot.evidenceId
               );
           }
       }
   }
   ```

3. **对话树节点编辑器**
   - 使用Unity GraphView API
   - 类似Shader Graph的节点连线编辑

4. **证据关系可视化**
   - 在Unity中绘制证据网络图
   - 自动验证关系完整性

**工作量**: 2-3个月（1名Unity工程师）

---

## 📊 三个方案对比

| 方案 | 可视化程度 | 开发成本 | 维护成本 | 学习曲线 | 推荐度 |
|------|-----------|---------|---------|---------|--------|
| A阶段1 | ⭐⭐⭐ | 极低 | 低 | 低 | ⭐⭐⭐⭐⭐ |
| A阶段2 | ⭐⭐⭐⭐ | 中 | 中 | 中 | ⭐⭐⭐⭐ |
| A阶段3 | ⭐⭐⭐⭐⭐ | 高 | 高 | 高 | ⭐⭐⭐ |

---

## 🎨 立即可用的可视化模板

### 模板1: Mermaid对话流程图

在Markdown中嵌入：

\`\`\`mermaid
graph TD
    D001[Morrison: 放下武器!] --> D002{Zack选择}
    D002 -->|解释身份| D003[我是侦探...]
    D002 -->|否认| D004[我没杀人!]
    D002 -->|指控| D005[这是陷阱!]
    D003 --> D006[Morrison质疑]
    D004 --> D007[Morrison追问]
    D005 --> D008[Morrison驳斥]
    D006 --> D009[证据确凿!]
    D007 --> D009
    D008 --> D009
    D009 --> D010[Emma: 慢着!]
\`\`\`

### 模板2: ASCII场景布局

```
SC103 - Rosa的储藏室 (3200x1600)
┌──────────────────────────────────────────────────────┐
│                                                      │
│    [EV001]                    [EV007]    [EV008]    │
│     架子                       桌子       纸箱1      │
│   (1200,800)                (900,700)  (1800,1000)  │
│                                                      │
│            [EV003]                      [EV009]      │
│            洗衣篮                        纸箱2       │
│          (600,900)                    (2000,950)     │
│                                                      │
│    [EV004]                                          │
│    地板痕迹 (在SC104)                                │
│                                                      │
└──────────────────────────────────────────────────────┘

鼠标可左右拖动范围: 0-640px
```

### 模板3: 证据关系表

| 证据ID | 名称 | 关系 | 目标证据 | 关系强度 | 说明 |
|--------|------|------|---------|---------|------|
| EV001 | 工作记录卡 | supports | EV003 | 0.8 | 证明Rosa应该在走廊 |
| EV001 | 工作记录卡 | contradicts | EV004 | 0.9 | 与Rosa证词矛盾 |
| EV002 | 氯仿瓶 | supports | EV003 | 0.95 | 组成迷晕工具 |
| EV002 | 氯仿瓶 | timeline_match | EV004 | 0.85 | 时间吻合 |

---

## 💻 我现在可以帮您做什么？

### 选项1: 生成可视化文档（推荐）
为现有的JSON配置生成配套的HTML可视化文档，包含：
- 场景热区标注图（需要您提供场景背景图）
- Mermaid对话流程图
- 证据关系网络图（使用vis.js）
- 指证逻辑表格

**所需信息**:
- 场景背景图文件路径

### 选项2: 重构JSON配置
在现有配置基础上添加可视化辅助字段：
- `visual_preview`
- `layout_diagram`
- `ascii_art`
- `annotated_image`

### 选项3: 创建Web可视化编辑器原型
开发一个简单的HTML+JS场景编辑器，可以：
- 上传场景图
- 拖拽标注热区
- 导出JSON配置

### 选项4: 生成Unity编辑器扩展代码
提供Unity Editor脚本，实现SceneConfig的可视化编辑

---

## 🎯 我的建议

**当前阶段最优方案**：

1. **立即执行**（今天）
   - 选项1: 生成可视化HTML文档
   - 在JSON中添加 `visual_preview` 和 `layout_diagram` 字段

2. **短期规划**（本周）
   - 用Figma在场景图上标注热区
   - 生成Mermaid对话流程图

3. **中期规划**（下月）
   - 开发简易Web场景编辑器
   - 或集成Unity Editor工具

您想先从哪个选项开始？我可以立即为您生成相应的内容。
