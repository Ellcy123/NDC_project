# 2025-11-06 工作总结：NDC内容生产框架设计

## 📋 核心成果

完成了**NDC游戏内容生产框架的完整设计**，建立了基于YAML配置的AI辅助工作流。

---

## 🎯 解决的核心问题

### 问题背景
- NDC项目包含大量游戏内容（证据、AVG文本、场景、指证玩法）
- 需要结构化的内容生产方式，支持批量产出
- 希望通过AI辅助进行创意筛选和逻辑验证
- 策划希望通过**对话方式**工作，而非手动编辑配置文件

### 解决方案
建立了**6层配置结构 + AI驱动的工作流**：
```
策划（自然语言对话）
    ↓
AI内容助手（维护YAML配置）
    ↓
程序（Unity直接读取）
    ↓
Excel预览（仅供查看）
```

---

## 🏗️ 6层配置架构

### Level 1: 章节元数据
- **作用**: 定义整个Unit的全局信息
- **内容**: 章节基本信息、6个循环概览、角色列表、过场动画
- **文件**: `Level1_Unit{N}_Metadata.yaml`

### Level 2: 循环配置
- **作用**: 定义单个Loop的玩法结构
- **内容**: 任务系统、游戏阶段、可用场景/对话/证据、指证配置
- **文件**: `Level2_Unit{N}_Loop{M}_Config.yaml`

### Level 3: 对话树
- **作用**: 定义AVG对话内容和分支逻辑
- **内容**: 对话节点、分支选择、对话奖励（解锁场景、获得证据）
- **文件**: `Level3_Unit{N}_Loop{M}_Dialog.yaml`

### Level 4: 证据配置
- **作用**: 定义所有证据及其关系网络
- **内容**: 证据属性、收集方式、证据间关系（矛盾/支持）
- **文件**: `Level4_Unit{N}_Loop{M}_Evidence.yaml`

### Level 5: 场景配置
- **作用**: 定义可探索场景及交互热区
- **内容**: 场景信息、热区坐标、NPC位置、解锁条件
- **文件**: `Level5_Unit{N}_Loop{M}_Scene.yaml`

### Level 6: 指证配置
- **作用**: 定义指证玩法的问答逻辑
- **内容**: 多轮指证、正确答案、难度参数、失败惩罚
- **文件**: `Level6_Unit{N}_Loop{M}_Expose_{NPC}.yaml`

---

## 💡 核心设计原则

### 1. 对话驱动工作流
**策划不需要**：
- ❌ 手动编辑JSON/YAML
- ❌ 记住字段名
- ❌ 检查引用关系
- ❌ 在Excel里改配置

**策划只需要**：
- ✅ 用自然语言描述需求
- ✅ 查看Excel预览确认
- ✅ 通过对话调整细节

### 2. 字段区分规范
- **无前缀字段**: 程序读取的正式字段（如 `scene_id`, `evidence_id`）
- **`_`前缀字段**: 策划备注，程序忽略（如 `_设计重点`, `_策划备注`）
- **`#`注释**: 纯文字说明

示例：
```yaml
scene_id: SC103           # 程序读取
name: 储藏室               # 程序读取
_设计重点: 核心搜证场景     # 程序忽略
_预估时长: 5分钟           # 程序忽略
```

### 3. AI自动验证机制
每次修改配置，AI自动检查：
- ✅ **引用完整性**: 引用的ID是否存在
- ✅ **逻辑闭环**: 玩家能否完成循环
- ✅ **数据一致性**: 难度配置、角色ID拼写是否一致

### 4. Excel仅供预览
- Excel表格由AI自动生成
- **仅用于可视化查看**，不用于编辑
- 用途：查看全局、发现问题、团队沟通、打印检查

---

## 📁 已交付的文档

### 核心文档（位于 `d:\NDC_project\AI生成\最终方案_YAML配置\`）

#### 1. `01_NDC内容生产工作流.md`
- 工作流总体介绍
- 三个核心环节（内容创作、配置管理、程序集成）
- 典型对话场景示例
- Excel预览的作用
- AI验证机制
- 快速开始指南

#### 2. `02_NDC配置详解.md`
- 6个Level的详细字段说明
- 跨Level引用关系
- 字段命名规范
- Unity读取代码示例
- 实际使用示例

#### 3. `Level1_Unit1_Metadata.yaml`
- Unit1的完整元数据配置
- 包含6个循环概览
- 8个主要角色信息
- 开场和结尾过场动画

#### 4. `Level1_字段说明书.md`
- Level1所有字段的详细说明
- 字段类型、必填性、程序用途
- Unity C#数据结构对应
- 快速检查清单

#### 5. `Level1_程序实现表格.md`
- 10个Markdown表格
- 可直接复制粘贴到Excel
- 用于程序实现参考

---

## 🔄 工作流演示

### 典型场景1: 添加新场景

**您说**：
```
在Loop1添加"Morrison的警车"场景，可以搜到赌债欠条（EV010）
```

**AI做**：
1. 修改Level2 - 添加场景到`available_scenes`
2. 修改Level5 - 创建场景配置（热区、解锁条件）
3. 修改Level4 - 添加证据EV010
4. 检查Level6 - 这个证据是否用于指证
5. 生成Excel预览

**AI问您**：
- 场景背景图文件名？
- 解锁条件是什么？
- 这个证据是关键证据吗？

### 典型场景2: 调整证据

**您说**：
```
把EV003（毛巾）改成不需要分析，直接看到氯仿气味
```

**AI做**：
1. 修改Level4 - `requires_analysis: false`
2. 更新描述为完整版
3. 检查指证配置是否受影响
4. 生成Excel预览

### 典型场景3: 调整难度

**您说**：
```
Loop1对Rosa的指证，Normal模式改成允许3次重试
```

**AI做**：
1. 修改Level6 - `wrong_attempts_allowed: 3`
2. 同步Level2的难度配置
3. 生成Excel预览

---

## 🛠️ 技术选型

### 配置格式：YAML
- **选择原因**: 可读性最强，支持注释，无冗余符号
- **对比过的格式**: JSON、JSON5、TOML
- **Unity集成**: YamlDotNet插件（或AI转JSON）

### 命名规范
| 类型 | 格式 | 示例 |
|------|------|------|
| Unit ID | `Unit{N}` | `Unit1` |
| Loop ID | `Unit{N}_Loop{M}` | `Unit1_Loop1` |
| NPC ID | `NPC{3位数字}` | `NPC002` |
| Scene ID | `SC{3位数字}` | `SC103` |
| Dialog ID | `D{3位数字}` | `D045` |
| Evidence ID | `EV{3位数字}` | `EV010` |
| Hotspot ID | `HS{场景}__{序号}` | `HS103_001` |

---

## 📊 数据流向示例

```
Level 1: Unit1
  └─ loop_id: Unit1_Loop1
         ↓
Level 2: Loop1_Config
  ├─ available_scenes: [SC103]
  ├─ available_dialogs: [D045]
  └─ collectible_evidence: [EV001]
         ↓           ↓           ↓
Level 3: Dialog    Level 4: Evidence    Level 5: Scene
  D045对话            EV001沾血毛巾         SC103储藏室
  rewards:           source_scene: SC103   hotspots:
    unlock_scenes:                           - result: EV001
      - SC103
         ↓
Level 6: Expose_Rosa
  options:
    - evidence_id: EV001
```

---

## 🎓 探索过程回顾

### 阶段1: 理解需求
- 阅读NDC全部策划文档
- 理解现有数据结构（NDC_DATA.md的12张表）
- 明确核心需求：支持AI辅助的批量内容生产

### 阶段2: 框架设计
- 提出6层配置架构
- 生成HTML可视化文档
- 创建Loop1完整配置示例

### 阶段3: 可读性优化
- 从纯JSON迭代到带注释的JSON
- 对比JSON5、TOML、YAML格式
- 最终选择YAML + `_`前缀规范

### 阶段4: 工作流明确
- 理解您的真实需求：对话驱动，而非手动编辑
- 明确Excel仅用于预览，不用于编辑
- 确立AI作为配置维护者的角色

### 阶段5: 文档化
- 创建工作流文档（面向策划）
- 创建配置详解文档（技术参考）
- 创建字段说明书和实现表格

---

## ✅ 关键决策点

### 决策1: YAML vs JSON
**选择**: YAML
**理由**:
- 可读性最强（缩进清晰，无冗余符号）
- 原生支持注释
- 策划编辑友好
- AI完全支持读写

### 决策2: 策划工作方式
**选择**: 对话驱动，而非文件编辑
**理由**:
- 策划不需要学习YAML语法
- 降低出错概率
- AI可以自动验证逻辑
- 更符合自然工作习惯

### 决策3: Excel的角色
**选择**: 仅供预览，不用于编辑
**理由**:
- YAML是唯一数据源
- Excel自动生成，保证同步
- 避免Excel编辑导致的格式问题
- Excel更适合可视化和沟通

### 决策4: 字段区分方式
**选择**: `_`前缀标记策划备注
**理由**:
- 清晰区分程序字段和备注
- 策划可以自由添加备注
- 程序解析时自动忽略
- 保持配置文件的自解释性

---

## 🚀 下一步计划

### 短期（本周内）
1. 根据您的反馈调整配置详解文档
2. 补充更多实际操作示例
3. 确认Unity C#数据结构是否匹配项目

### 中期（下周）
1. 基于Loop1示例，生成Loop2-6的配置框架
2. 完善Unit1的完整配置
3. 测试AI辅助修改配置的流程

### 长期（后续）
1. 创建其他5个Unit的配置
2. 建立配置版本管理流程
3. 编写Unity读取配置的完整代码示例

---

## 📝 待调整事项

配置详解文档（02）是初步版本，需要与您一起调整：

### 需要确认的内容
- [ ] 字段是否有遗漏？
- [ ] 字段类型是否准确？
- [ ] 枚举值是否完整？
- [ ] 跨Level引用关系是否清晰？

### 需要补充的内容
- [ ] 是否需要更多实际操作示例？
- [ ] Unity集成代码是否符合项目结构？
- [ ] 是否有特殊场景需要详细说明？

---

## 💬 对话要点摘录

### 您的核心需求
> "我希望的是程序能直接从你这边的文档转化为unity能够使用的文件，然后我通过对话的形式也可以让你修改部分内容，而Excel的输出仅仅只是辅助我查看"

### 关键转折点
> "我有点看不懂，按照你这个生成一个html文件"
→ 意识到需要更直观的可视化

> "你这个配置比如说level5的是用于逻辑构建还是代码实现呢，可视化差了一些"
→ 引入YAML和注释机制

> "我不是一定想读表格，我觉得表格的可读性很一般"
→ 探索多种配置格式

> "A+C的方式吧"
→ 确定最终方案（YAML + 字段说明书）

---

## 📊 工作量统计

### 生成的配置文件
- 1个Level1元数据配置（Unit1）
- 6个Level说明文档
- 4种格式对比示例（JSON/JSON5/YAML/TOML）
- 1个HTML可视化文档
- 1套Loop1完整示例（6个Level的JSON配置）

### 编写的文档
- 2篇核心文档（工作流 + 配置详解）
- 1篇字段说明书
- 1篇格式对比说明
- 1篇可视化增强方案
- 1篇程序实现表格

### 代码示例
- Unity C#数据结构定义
- YAML读取代码示例
- 配置文件命名规范
- ID引用检查逻辑

---

## 🎯 核心价值

### 对您的价值
1. **降低工作量**: 通过对话完成配置修改，无需学习语法
2. **减少出错**: AI自动验证引用和逻辑
3. **提高效率**: 批量生成配置框架，快速迭代
4. **改善协作**: Excel预览方便团队沟通

### 对项目的价值
1. **结构化内容**: 6层配置清晰分离关注点
2. **易于维护**: 配置文件可读，易于版本管理
3. **程序友好**: 直接读取YAML/JSON，无需手动解析Excel
4. **可扩展性**: 框架支持添加新Unit/Loop/角色/证据

### 对团队的价值
1. **降低门槛**: 策划无需技术背景也能使用
2. **知识共享**: 配置文件自解释，新人易上手
3. **质量保证**: AI验证减少逻辑错误
4. **快速迭代**: 支持快速调整和测试

---

## 📌 关键文件路径

```
d:\NDC_project\AI生成\
├── 最终方案_YAML配置\
│   ├── 01_NDC内容生产工作流.md          ← 工作流总览
│   ├── 02_NDC配置详解.md                ← 技术详解
│   ├── Level1_Unit1_Metadata.yaml       ← Unit1元数据
│   ├── Level1_字段说明书.md             ← 字段文档
│   └── Level1_程序实现表格.md           ← Excel表格
│
├── Unit1_Loop1_完整配置示例\            ← Loop1完整示例
├── JSON可读性最强版本\                   ← 增强JSON示例
├── 其他格式对比\                         ← 格式对比文档
└── NDC内容生产框架.html                  ← 可视化HTML
```

---

## 🔚 总结

今天完成了NDC内容生产框架的**完整设计和文档化**，建立了：
- ✅ 6层配置架构（从章节到指证的完整层级）
- ✅ 对话驱动的AI辅助工作流
- ✅ YAML配置 + Excel预览的双轨方案
- ✅ 自动验证机制和命名规范
- ✅ 完整的文档体系（工作流 + 技术详解）

这套框架使您能够：
- 用自然语言描述需求，由AI维护配置
- 通过Excel预览快速检查和沟通
- 让程序直接读取配置文件
- 降低错误，提高内容生产效率

**下一步**是根据您的反馈调整配置详解文档，然后开始实际使用这套框架生成Unit1的完整内容。

---

**日期**: 2025-11-06
**耗时**: 完整对话会话
**状态**: 框架设计完成，待实际应用验证
