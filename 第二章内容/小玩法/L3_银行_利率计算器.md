# 玩法设计文档：利率计算器 (The Interest Rate Calculator)

**文档版本**: v1.0
**隶属章节**: Unit 2 - 循环2/3
**设计目标**: 通过交互式解谜，让玩家直观感受高利贷的掠夺性，将抽象的数学计算转化为情感冲击。

---

## 1. 玩法概述 (Overview)

*   **玩法类型**: data_analysis / puzzle_drag_drop
*   **核心体验**: **填空还原算式** -> **动态演算演示** -> **生成关键证据**
*   **预期时长**: 30-60秒
*   **对应剧情**: Zack Brennan 试图验证 Moore 银行的贷款条款是否与其口头承诺/催款信一致。

### 1.1 触发条件 (Entry Trigger)
玩家需在游戏中同时获得以下两个证据，并在**物品栏 (Inventory)** 中查看其中任意一个的详情时触发：
1.  **证据201【催款信】** (Collection Letter) - *Loop 2 或 Loop 3 获取*
    *   关键信息：欠款总额 $3,200
2.  **证据305/306【贷款条款】** (Loan Agreement) - *Loop 3 银行档案室获取*
    *   关键信息：本金 $600，月利率 12%，月管理费 $50，期限 12个月

**触发表现**:
*   当玩家查看详情时，Zack 触发独白：“这两份文件里的数字...有点对不上。我需要算算这笔账。”
*   屏幕右下角出现高亮的 **[💡 验证算式]** 按钮。
*   点击按钮进入独立的小玩法界面。

### 1.2 流程图解 (Visual Flow)

```
┌─────────────────────────────────────────────────────────────┐
│                   【玩法流程图解】                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   🟢 [开始]                                                 │
│       ↓                                                     │
│   🔍 [触发: 查看201/305/306详情]                            │
│       ↓                                                     │
│   🖥️ [进入交互界面: 左侧证据 vs 右侧算式]                   │
│       ↓                                                     │
│   ┌───────────────────────────────────────────────────┐     │
│   │               【核心循环】                        │     │
│   │                                                   │     │
│   │     Wait...                                       │     │
│   │   ✋ 玩家拖拽数字到槽位                           │     │
│   │       │                                           │     │
│   │       ├──❌ 填错 → 💥 弹回 + "Zack语音提示"       │     │
│   │       │                                           │     │
│   │       └──✅ 填对 → 📌 吸附 + "落笔声"             │     │
│   │                       ↓                           │     │
│   │                 [4格全满?] ───→ No ↺              │     │
│   │                       ↓ Yes                       │     │
│   └───────────────────────┼───────────────────────────┘     │
│                           ↓                                 │
│                   🔴 [出现"开始计算"按钮]                   │
│                           ↓                                 │
│                   📉 [播放恐怖演算动画]                     │
│               (数字暴涨/音效加速/背景压抑)                  │
│                           ↓                                 │
│                   💰 [最终定格: $3,200!]                    │
│                           ↓                                 │
│               🏆 [证据升级: 高利贷算式铁证]                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 界面与交互 (UI & Interaction)

### 2.1 界面布局 (Layout)

```
┌─────────────────────────────────────────────────────────────┐
│                    【游戏屏幕布局】                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌───────────────────────┐  ┌───────────────────────────┐   │
│  │【证据提取区】 (左侧)   │  │【公式演算区】 (右侧)       │   │
│  │                       │  │                           │   │
│  │ ┌─────────┐┌─────────┐│  │  📓 侦探笔记              │   │
│  │ │ 贷款    ││ 催款信  ││  │                           │   │
│  │ │ 条款    ││ $3200   ││  │  最终债务 =               │   │
│  │ │       ★ ││         ││  │                           │   │
│  │ │ 12%     ││         ││  │  ( [ ] × (1+[ ])^[ ] )    │   │
│  │ └────┼────┘└─────────┘│  │    ↑      + ([ ] × 12)    │   │
│  │      │                │  │    │                      │   │
│  └──────┼────────────────┘  │    │ 拖拽填空             │   │
│         │                   │    │                      │   │
│         └───────────────────┼────┘                      │   │
│                             │                           │   │
│                             │    [ 🔴 开始计算 ]        │   │
│                             └───────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

采用拟物化风格，模拟侦探在办公桌上整理证据。

*   **背景**: 昏暗的木质桌面，一盏台灯照亮中央区域。
*   **左区 (证据源)**: 
    *   并排展示【贷款条款】和【催款信】。
    *   关键数字区域（本金、利率、期限、管理费）呈现**可交互的高亮状态**（虚线框包裹）。
*   **右区 (演算本)**: 
    *   Zack 的侦探笔记本，翻开到新的一页。
    *   页面上印有一个手写的数学公式模板，留有 4 个空白槽位。
    *   公式：`最终债务 = ( [  ] × (1 + [  ]) ^ [  ] ) + ( [  ] × 12 )`
    *   对应槽位标签（悬停显示）：`[本金]`、`[月利率]`、`[期限]`、`[月管理费]`

### 2.2 交互逻辑 (Core Loop)
1.  **拖拽填空**: 
    *   玩家按住左侧证据中的高亮数字，拖拽至右侧公式的对应槽位。
    *   **正确反馈**: 数字吸附入槽位，发出清脆的“落笔声”，字体变为手写体。
    *   **错误反馈**: 数字抖动并弹回原处，发出轻微的“纸张摩擦声”，Zack 提示：“不，这一项不该填这里。”
2.  **开始计算**:
    *   4个槽位全部填满后，笔记本下方出现 **[开始计算]** 按钮（红色印泥风格）。
    *   点击后进入**演算动画阶段**。

---

## 3. 演算演示 (Calculation Sequence)

这是本玩法的“高光时刻” (Moment of Truth)，重点在于**视觉化利息的恐怖增长**。

### 3.1 动画流程
1.  **灯光变化**: 背景灯光压暗，聚光灯集中在笔记本的数字区域。
2.  **时间流逝**: 
    *   笔记本上出现一个“月份计数器”，从 `Month 1` 开始快速跳动直到 `Month 12`。
    *   背景音效：时钟的滴答声，随着月份增加频率越来越快，最后变成类似心跳的重低音。
3.  **数字暴涨**:
    *   算式结果区域的数字开始滚动累加。
    *   前3个月：增长缓慢（$700... $800...），字体为黑色。
    *   4-8个月：增长加速（$1200... $1800...），字体开始变深红，笔迹变得潦草。
    *   9-12个月：数字疯狂跳动（$2500... $3100...），字体变为鲜红的血色质感，伴随屏幕轻微震动。
4.  **结果定格**:
    *   画面猛地一顿，定格在最终数字 **$3,200** (约数)。
    *   Zack 的手出现，用红笔在数字上重重画了一个圈。
    *   音效：重重的钢琴低音或重击声。

### 3.2 结算 (Result)
*   **文字总结**: 屏幕浮现总结文字 —— “年化利率 300%... 这不是贷款，这是屠杀。”
*   **证据升级**: 
    *   【催款信】升级为 **【高利贷算式铁证】 (Predatory Loan Calculation)**。
    *   描述更新：“经过验证的计算结果。Moore银行利用复利陷阱，强行将$600的债务在一年内变成了$3,200。”

---

## 4. 特殊情况处理 (Edge Case Handling)

为确保“无论玩家如何操作都不会破坏体验”，需严格定义以下边界情况：

### 4.1 玩家中途退出 (Mid-game Exit)
*   **场景**: 玩家在填空阶段或动画阶段点击了【返回/关闭】按钮，或按下了 ESC 键。
*   **处理逻辑**:
    1.  **弹窗确认**: 显示系统弹窗 “计算尚未完成，确定要停止验证吗？” (选项: 继续 / 停止)。
    2.  **状态重置**: 
        *   若选择停止，退出小玩法界面。
        *   **不保存**当前的填空进度（因为流程很短，下次重置能加深印象）。
        *   证据状态保持为“未验证”。
        *   **再次触发机制**: 玩家仍可通过点击物品栏中的【💡 验证算式】按钮随时重新开始。

### 4.2 错误尝试过多 (Spamming Errors)
*   **场景**: 玩家不知道该怎么填，胡乱拖拽数字尝试。
*   **处理逻辑**:
    *   **连续错误3次后**: 
        *   Zack 触发语音提示：“公式的第一项是**本金**，也就是Frank最初借的那笔钱。”
        *   对应的正确数字（$600）在左侧证据中闪烁提示。
    *   **连续错误5次后**:
        *   启用“吸附辅助”：当玩家拖拽正确数字接近目标槽位时，吸附范围扩大 200%。

### 4.3 动画播放期间的输入 (Input during Animation)
*   **场景**: 在数字滚动演算期间，玩家尝试点击屏幕或拖拽其他物品。
*   **处理逻辑**:
    *   **屏蔽交互**: 演算阶段（约 3-4 秒）屏蔽所有非系统级输入。
    *   **跳过功能**: 右上角提供半透明的 **[长按跳过]** 按钮（防止二周目玩家厌烦），长按 1.5秒可直接跳至结果定格画面。

### 4.4 缺少必要证据 (Missing Evidence - 防御性设计)
*   **场景**: 理论上触发条件已卡死，但防止代码逻辑错误（如因Bug导致玩家丢失了条款）。
*   **处理逻辑**:
    *   如果进入玩法时检测到必要证据缺失，Zack 独白：“等等，我手里资料不全，还没法算清楚。”
    *   自动退出玩法界面，并提示玩家“寻找更多关于贷款条款的信息”。

### 4.5 演算系数值边界 (Math Edge Cases)
*   为了防止显示的数字出现小数点后太多位影响美观：
    *   **显示规则**: 滚动过程中向下取整显示整数（`Math.floor`）。
    *   **最终结果**: 强制显示为格式化货币字符串（如 `$3,198.50` -> `$3,200` 近似值），并在UI上用 `≈` 符号标注，确保与催款信上的整百数字视觉统一。

---

## 5. 数据配置表 (Data Spec)

| 参数名 | 值 | 说明 |
| :--- | :--- | :--- |
| `LOAN_PRINCIPAL` | 600 | 本金 |
| `INTEREST_RATE` | 0.12 | 月利率 (12%) |
| `LOAN_TERM` | 12 | 期限 (月) |
| `MONTHLY_FEE` | 50 | 管理费 |
| `TARGET_RESULT` | 3200 | 目标显示结果 (剧情值) |
| `ANIMATION_DURATION` | 4.5s | 演算动画总时长 |
| `ERROR_SHAKE_INTENSITY` | 15px | 错误拖拽抖动幅度 |

---

## 6. 开发备注 (Dev Notes)
*   **美术资源**: 需要新的“笔记本摊开”背景图，以及手写数字的字体集（0-9, $, +, %, /, =）。
*   **音效**: 重点在于最后定格的重音，需要有“审判落下”的沉重感。
*   **本地化**: 公式中的文字标签需支持多语言配置（Key: `GAME_MINI_CALC_PRINCIPAL`, etc.）。
